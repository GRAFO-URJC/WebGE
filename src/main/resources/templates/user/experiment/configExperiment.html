<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.w3.org/1999/xhtml"
      lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link th:href="@{/assets/dist/css/bootstrap.css}" rel="stylesheet" id="main-css" />
    <link th:href="@{/assets/dist/css/configExperiment.css}" rel="stylesheet" id="configExperiment-css" />

    <!--<script type="text/javascript" src="/assets/dist/jqplot/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/dist/jqplot/jquery.jqplot.min.js"></script>-->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="/assets/dist/jQuery/jquery-3.3.1.min.js"></script>
    <!--<link th:href="@{/assets/dist/jqplot/jquery.jqplot.min.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/assets/dist/jqplot/jquery/jquery.min.js}" />
    <link th:href="@{/assets/dist/jqplot/jquery.jqplot.min.js}" />-->

    <style>
        .line {
            fill: none;
            stroke: #000;
            stroke-width: 1.5px;
        }
    </style>

    <title>Experiment testing area</title>
</head>

<!--
    Attribute th:field will replace attributes value, id and name in your input tag.

    Instead, use plain th:id, th:value and th:name without using th:field. Then you will get what you wanted.
-->
<body>
<div>

    <!-- Header -->
    <header class="navbar navbar-default navbar-static-top" id="header">
        <div class="container">

            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".header-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" th:href="@{/}">WebGE <i>by URJC</i></a>
            </div>

            <div class="collapse navbar-collapse header-collapse">
                <ul sec:authorize="isAuthenticated()" class="nav navbar-nav">
                    <li><a th:href="@{/}">Home</a></li>
                    <li><a th:href="@{/user/experiment/experimentRepository}">Experiments</a></li>
                    <li><a th:href="@{/user/profile}">Profile</a></li>

                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Submenu<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Option One</a></li>
                            <li><a href="#">Option Two</a></li>
                            <li><a href="#">Option Three</a></li>
                            <li><a href="#">Option Four</a></li>
                        </ul>
                    </li>
                </ul>

                <p sec:authorize="isAuthenticated()" class="navbar-text navbar-right btn btn-default"><a  th:href="@{/logout}">Logout</a></p>
                <p sec:authorize="isAnonymous()" class="navbar-text navbar-right btn btn-default"><a th:href="@{/registration}">Registration</a></p>
                <p sec:authorize="isAnonymous()" class="navbar-text navbar-right btn btn-default"><a th:href="@{/user}">Login</a></p>

            </div>
        </div>
    </header>
    <!-- END Header -->

    <!-- Main -->
    <div class="container">
        <div id="forms" class="panel panel-default">
            <header class="panel-heading">
                <h2>Experiment configuration area</h2>
            </header>

            <section class="panel-body">
                <form th:action="@{/user/experiment/start}" enctype="multipart/form-data" th:object="${configExp}" role="form" method="POST">
                    <div class="row center-block form-horizontal">

                        <p class="text-warning"
                           th:if="${#fields.hasGlobalErrors()}"
                           th:each="error : ${#fields.errors('global')}"
                           th:text="${error}">Validation error</p>

                        <!-- Experiment NAME and DESCRIPTION -->
                        <div class="row form-group">
                            <div class="col-sm-12 col-md-12 col-lg-12" >
                                <input type="text" class="form-control hiddenInput" id="id" name="id" th:value="${configuration.getId()}" placeholder="Id of the experiment" />
                            </div>
                        </div>

                        <div class="row form-group">
                            <div class="col-sm-12 col-md-12 col-lg-12" >
                                <!-- Error handling -->
                                <p class="text-warning"
                                   th:each="error: ${#fields.errors('experimentName')}"
                                   th:text="${error}">Validation error
                                </p>
                                <!-- END error handling -->
                                <div th:classappend="${#fields.hasErrors('experimentName')}? 'has-error':'experimentName error'">
                                    <input type="text" class="form-control" id="experimentName" name="experimentName" th:value="${configuration.getExperimentName()}" placeholder="Name of the experiment" />
                                </div>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-sm-12 col-md-12 col-lg-12">
                                <!-- Error handling -->
                                <p class="text-warning"
                                   th:each="error : ${#fields.errors('experimentDescription')}"
                                   th:text="${error}">Validation error</p>
                                <!-- END error handling -->
                                <div th:classappend="${#fields.hasErrors('experimentDescription')}? 'has-error':'experimentDescription error'">
                                    <input type="text" class="form-control" id="experimentDescription" name="experimentDescription" th:value="${configuration.getExperimentDescription()}" placeholder="Description of the experiment" />
                                </div>
                            </div>
                        </div>
                        <!-- END Experiment NAME and DESCRIPTION -->

                        <div class="col-sm-12 col-md-12 col-lg-12">
                            <hr/>
                        </div>

                        <!-- PropertiesDto -->
                        <div class="col-sm-12 col-md-6 col-lg-6">
                            <div class="row form-group">
                                <div class="jumbotron row form-group">
                                    <h3>Properties of the experiment</h3>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <label for="generations">Generations:</label>
                                    <div th:classappend="${#fields.hasErrors('generations')}? 'has-error':'generations error'">
                                        <input type="number" class="text-center" th:min="0" th:value="${configuration.getGenerations()}" name="generations" id="generations"/>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <label for="crossoverProb">Crossover Prob.:</label>
                                    <div th:classappend="${#fields.hasErrors('crossoverProb')}? 'has-error':'crossoverProb error'">
                                        <input type="number" class="text-center" th:min="0" th:step="0.01" th:value="${configuration.getCrossoverProb()}" name="crossoverProb" id="crossoverProb"/>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <label for="populationSize">Population size:</label>
                                    <div th:classappend="${#fields.hasErrors('populationSize')}? 'has-error':'populationSize error'">
                                        <input type="number" class="text-center" th:min="0" th:max="100000" th:value="${configuration.getPopulationSize()}" name="populationSize" id="populationSize" />
                                    </div>
                                </div>
                            </div>

                            <div class="row form-group">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <label for="mutationProb">Mutation Prob.:</label>
                                    <div th:classappend="${#fields.hasErrors('mutationProb')}? 'has-error':'mutationProb error'">
                                        <input type="number" class="text-center" th:min="0" th:step="0.01" th:value="${configuration.getMutationProb()}" name="mutationProb" id="mutationProb"/>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <label for="maxWraps">Max wraps:</label>
                                    <div th:classappend="${#fields.hasErrors('maxWraps')}? 'has-error':'maxWraps error'">
                                        <input type="number" class="text-center" th:min="0" th:value="${configuration.getMaxWraps()}" value="3" name="maxWraps" id="maxWraps"/>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <label for="numCodons">Num. Codons:</label>
                                    <div th:classappend="${#fields.hasErrors('numCodons')}? 'has-error':'numCodons error'">
                                        <input type="number" class="text-center" th:min="0" th:value="${configuration.getNumCodons()}" value="100" name="numCodons" id="numCodons" />
                                    </div>
                                </div>
                            </div>

                            <div class="row form-group text-center">
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <label for="tournament">Tournament:</label>
                                    <div th:classappend="${#fields.hasErrors('tournament')}? 'has-error':'tournament error'">
                                        <input type="number" class="text-center" th:min="0" th:value="${configuration.getTournament()}" value="2" name="tournament" id="tournament" />
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <label for="numberRuns">Number of runs:</label>
                                    <div th:classappend="${#fields.hasErrors('numberRuns')}? 'has-error':'numberRuns error'">
                                        <input type="number" class="text-center" th:min="0" th:value="${configuration.getNumberRuns()}" value="1" name="numberRuns" id="numberRuns" />
                                    </div>
                                </div>
                            </div>

                            <!--0 -> Root Mean Squared Error (RMSE)
                            1 -> Clarke Error Grid (CEG)
                            2 -> Bi-objective: RMSE & RMSE
                            3 -> R Square (R^2)
                            4 -> Absolute Error (Abs. Error)
                            5 -> Mean Absolute Relative Deviation (MARD) -->
                            <div class="row form-group text-center">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <label for="tournament">Tournament:</label>
                                    <select class="form-control" name="objective">
                                        <option value="RMSE">Root Mean Squared Error (RMSE)</option>
                                        <option value="CEG">Clarke Error Grid (CEG)</option>
                                        <option value="RMSECEG">Bi-objective: RMSE y CEG</option>
                                        <option value="R2">R Square (R^2)</option>
                                        <option value="MARD">Mean Absolute Relative Deviation (MARD)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <!-- END PropertiesDto -->

                        <!-- Grammar file -->
                        <div class="col-sm-12 col-md-6 col-lg-6 center-block">
                            <div class="jumbotron row form-group">
                                <h3>Grammar file information</h3>
                            </div>
                            <div class="row form-group center-block">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <span>Upload your grammar file: <input type="file" name="grammarFile" id="grammarFile"/></span>
                                    <p class="help-block">Select or drop your grammar to be run here</p>
                                </div>
                            </div>
                            <div class="row form-group">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <!-- Error handling -->
                                    <p class="text-warning"
                                       th:each="error: ${#fields.errors('grammarName')}"
                                       th:text="${error}">Validation error
                                    </p>
                                    <!-- END error handling -->
                                    <div th:classappend="${#fields.hasErrors('grammarName')}? 'has-error':'grammarName error'">
                                        <input type="text" class="form-control" th:value="${grammar.getGrammarName()}" name="grammarName" id="grammarName" placeholder="Name of the grammar" />
                                    </div>
                                </div>
                            </div>
                            <br/>

                            <div class="row form-group">
                                <div class="col-sm-12 col-md-12 col-lg-12" >
                                    <!-- Error handling -->
                                    <p class="text-warning"
                                       th:each="error : ${#fields.errors('grammarDescription')}"
                                       th:text="${error}">Validation error</p>
                                    <!-- END error handling -->
                                    <div th:classappend="${#fields.hasErrors('grammarDescription')}? 'has-error':'grammarDescription error'">
                                        <input type="text" class="form-control" th:value="${grammar.getGrammarDescription()}" name="grammarDescription" id="grammarDescription" placeholder="Description of the grammar" />
                                    </div>
                                </div>
                            </div>
                            <br/>

                            <div class="row form-group">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <!-- Error handling -->
                                    <p class="text-warning"
                                       th:each="error: ${#fields.errors('fileText')}"
                                       th:text="${error}">Validation error
                                    </p>
                                    <!-- END error handling -->
                                    <div th:classappend="${#fields.hasErrors('fileText')}? 'has-error':'fileText error'">
                                        <textarea rows="5" class="form-control" th:text="${grammar.getFileText()}" placeholder="Grammar file "  name="fileText" id="fileText" th:inline="text" style="resize: none;" />
                                    </div>
                                </div>
                            </div>
                            <br/>

                            <div class="row form-group text-center">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <a name="downloadGrammarButton" id="downloadGrammarButton" class="btn-default btn-sm">Download grammar</a>
                                </div>
                            </div>
                        </div>
                        <!-- END Grammar file -->

                        <div class="col-sm-12 col-md-12 col-lg-12">
                            <hr/>
                        </div>

                        <!-- Training Test Validation files -->
                        <div class="col-sm-12 col-md-12 col-lg-12 center-block">
                            <div class="jumbotron row form-group">
                                <h3>Data type information</h3>
                            </div>
                            <div class="row form-group center-block">
                                <div class="col-sm-12 col-md-12 col-lg-8">
                                    <!-- Error handling -->
                                    <p class="text-warning"
                                       th:each="error : ${#fields.errors('dataTypeName')}"
                                       th:text="${error}">Validation error</p>
                                    <!-- END error handling -->
                                    <div th:classappend="${#fields.hasErrors('dataTypeName')}? 'has-error':'dataTypeName error'">
                                        <input type="text" class="form-control" name="dataTypeName" id="dataTypeName" th:value="${type.getDataTypeName()}" placeholder="Name" />
                                    </div>
                                </div>
                            </div>
                            <div class="row form-group">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <!-- Error handling -->
                                    <p class="text-warning"
                                       th:each="error: ${#fields.errors('dataTypeDescription')}"
                                       th:text="${error}">Validation error
                                    </p>
                                    <!-- END error handling -->
                                    <div th:classappend="${#fields.hasErrors('dataTypeDescription')}? 'has-error':'dataTypeDescription error'">
                                        <input type="text" class="form-control" name="dataTypeDescription" id="dataTypeDescription" th:value="${type.getDataTypeDescription()}" placeholder="Description of the file" />
                                    </div>
                                </div>
                            </div>

                            <div class="row form-group text-center">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <!-- Error handling -->
                                    <p class="text-warning"
                                       th:each="error : ${#fields.errors('dataTypeType')}"
                                       th:text="${error}">Validation error</p>
                                    <!-- END error handling -->
                                    <input type="radio" th:name="dataTypeType" th:id="dataTypeType" th:value="traininng" checked="checked"/> Training
                                    <input type="radio" th:name="dataTypeType" th:id="dataTypeType" th:value="validation" /> Validation
                                    <input type="radio" th:name="dataTypeType" th:id="dataTypeType" th:value="test" /> Test
                                </div>
                            </div>

                            <div class="row form-group">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <!-- Error handling -->
                                    <p class="text-warning"
                                       th:each="error: ${#fields.errors('typeFile')}"
                                       th:text="${error}">Validation error
                                    </p>
                                    <!-- END error handling -->
                                    <div th:classappend="${#fields.hasErrors('typeFile')}? 'has-error':'typeFile error'">
                                        <input type="file" name="typeFile" id="typeFile" required="required" />
                                    </div>
                                </div>
                            </div>

                            <!-- Data Type table to load -->
                            <input class="hiddenRadio" type="radio" th:name="radioDataType" th:id="radioDataTypeHidden" checked="checked" />
                            <div th:if="${not #lists.isEmpty(dataTypeList)}">
                                <h2>Data type files</h2>
                                <table class="table table-hover" id="expTypeTable">
                                    <thead>
                                    <tr>
                                        <th scope="col">   </th>
                                        <th scope="col">Id ExpDataType</th>
                                        <th scope="col">File name</th>
                                        <th scope="col">File description</th>
                                        <th scope="col">File type</th>
                                        <th scope="col">Creation date</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr id="" th:each="dataType, iterStat : ${dataTypeList}">     <!-- We are using model Experiment and not ExperimentDto -->
                                        <td scope="row"><input type="radio" th:id="radioDataType" th:name="radioDataType" th:value="${dataType.getId()}" onclick="check()"/></td>
                                        <td scope="row"><label th:text="${dataType.getId()}" th:id="'expDataTypeIdList'+${iterStat.count}" th:name="expDataTypeIdList" /></td>
                                        <td scope="row"><label th:text="${dataType.getDataTypeName()}" th:name="expDataTypeNameList" th:id="expDataTypeNameList" /></td>
                                        <td scope="row"><label th:text="${dataType.getDataTypeDescription()}" th:name="expDataTypeDescriptionList" th:id="expDataTypeDescriptionList" /></td>
                                        <td scope="row"><label th:text="${dataType.getDataTypeType()}" th:name="expDataTypeTypeList" th:id="expDataTypeTypeList" /></td>
                                        <td scope="row"><label th:text="${dataType.getCreationDate()}" th:name="status" th:id="status" /></td>
                                        <!--<td scope="row"><a class="btn-default btn-sm" onclick="fillInput($(user.getId()) ,$(dataType.getId()),  $(dataType.getDataTypeName()))" id="loadDataTypeButton" name="loadDataTypeButton">select</a></td>-->
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- END Data Type table to load -->

                            <div class="row form-group text-center">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <a name="downloadTypeButton" id="downloadTypeButton" class="btn-default btn-sm">Download data type file</a>
                                </div>
                            </div>
                        </div>
                        <!-- END Training Test Validation files -->

                        <div class="col-sm-12 col-md-12 col-lg-12">
                            <hr/>
                        </div>

                        <!--  Save Clone and Run -->
                        <div class="row text-center">
                            <div class="col-sm-4 col-md-4 col-lg-4">
                                <button type="submit" id="saveExperimentButton" name="saveExperimentButton" class="btn-primary btn-lg">Save experiment</button>
                            </div>
                            <div class="col-sm-4 col-md-4 col-lg-4">
                                <button type="submit" id="cloneExperimentButton" name="cloneExperimentButton" class="btn-primary btn-lg">Clone experiment</button>
                            </div>
                            <div class="col-sm-4 col-md-4 col-lg-4">
                                <button type="submit" id="runExperimentButton" name="runExperimentButton" class="btn-primary btn-lg" onclick="runExperiment()">Run experiment</button>
                            </div>
                        </div>
                        <!-- END Save Clone and Run -->

                    </div>
                </form>
            </section>
        </div>
    </div>
    <!-- END Main -->

    <!-- RUN SECTION -->
    <div class="container" th:if="${not #lists.isEmpty(runList)}">
        <div id="forms" class="panel panel-default">
            <header class="panel-heading">
                <h2>Experiment runs area information</h2>
            </header>

            <section class="panel-body">
                <div>
                    <h2>List of runs</h2>
                    <table class="table table-hover" id="expTypeTable">
                        <thead>
                        <tr>
                            <th scope="col"># Run</th>
                            <th scope="col">Experiment name</th>
                            <th scope="col">Experiment description</th>
                            <th scope="col">Status</th>
                            <th scope="col">Creation date</th>
                            <th scope="col">Last modification date</th>
                        </tr>
                        </thead>
                        <tbody>

                        <input type="text" class="form-control" th:name="defaultRunId" th:id="defaultRunId" th:value="${configuration.getDefaultRunId()}" />
                        <th:block th:each="run, iterStat : ${runList}">
                            <tr>
                                <form th:action="@{/user/experiment/runList}" th:object="${runObj}" method="GET" class="form-horizontal">
                                    <input type="text" class="hiddenInput" th:name="runId" th:id="runId" th:value="${run.getId()}" />
                                    <td scope="row"><label th:text="${run.getId()}" /></td>
                                    <td scope="row"><label th:name="runName" th:id="runName" th:text="${run.getRunName()}" /></td>
                                    <td scope="row"><label th:name="runDescription" th:id="runDescription" th:text="${run.getRunDescription()}" /></td>
                                    <td scope="row"><label th:name="status" th:id="status" th:text="${run.getStatus()}" /></td>
                                    <td scope="row"><label th:name="iniDate" th:id="iniDate" th:text="${run.getIniDate()}" /></td>
                                    <td scope="row"><label th:name="lastDate" th:id="lastDate" th:text="${run.getLastDate()}" /></td>

                                    <td scope="row">
                                        <button type="submit" id="loadExperimentButton" name="loadExperimentButton" class="btn-default loadButton">Load experiment</button>
                                    </td>
                                    <td scope="row">
                                        <a th:href="'#collapse'+${iterStat.index}" data-toggle="collapse" class="accordion-toggle">More details <span class="glyphicon glyphicon-chevron-down"></span></a>
                                    </td>
                                </form>
                            </tr>

                            <tr>
                                <td colspan="9">
                                    <div class="panel-collapse collapse" th:id="'collapse'+${iterStat.index}">
                                        <h4><b>Run details </b></h4>
                                        <br/>
                                        <ul class="list-inline">
                                            <li>
                                                        <span class="glyphicon glyphicon-chevron-right">
                                                            Experiment ID:
                                                            <label th:text="${configuration.getId()}"></label>
                                                        </span>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </th:block>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>
    <!-- END RUN SECTION -->

    <!-- D3 Section -->
    <div class="container">
        <div class="panel panel-default">
            <header class="panel-heading">
                <h2>D3 Flow Diagram</h2>
            </header>

            <section class="panel-body">
                <div>
                    <h2>D3 Diagram</h2>
                </div>
                <div id="d3">

                </div>

                <svg width="960" height="500"></svg>

                <div id="chartContainer" style="height: 300px; width: 100%;"></div>

                <div class="graph"></div>
            </section>
        </div>
    </div>
    <!-- END D3 Section -->
</div>


<!-- load the d3.js library -->
<!--<script src="https://d3js.org/d3.v5.min.js"></script>-->
<!--<script src="//d3js.org/d3.v4.min.js"></script>-->
<!--<script type="text/javascript" src="/assets/dist/d3/d3-time-format/d3-time-format.js"></script>-->
<!--<script src="https://d3js.org/d3-time.v1.min.js"></script>
<script src="https://d3js.org/d3-time-format.v2.min.js"></script>-->
<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

<script>

    var chart;
    var dataPoints = [];
    var duration = 1000;
    var n = 243;
    var now = new Date(Date.now() - duration);

    function tick(data) {
        $.each(data, function(key, value) {

            now = new Date();
            var xPoint = new Date();
            var yPoint = data['bestIndividual'];

            dataPoints.push({
                x: parseInt(xPoint),
                y: parseFloat(yPoint)
            });
        });

        if (dataPoints.length >  10)
        {
            dataPoints.shift();
        }

        // sortDataPoints(data, 'x'); // sort dataPoints based on x
        chart.render();
        setTimeout(function(){reloadPlotD3()}, 1000);
    }

    function reloadPlotD3() {
        $.ajax({
            url: encodeURI("/user/rest/diagramFlow"),
            type: "GET",
            dataType: "json",
            success: function(data){

                var xPoint = new Date();
                var yPoint = data['bestIndividual'];

                $.each(data, function(key, value){
                    dataPoints.push({x: xPoint, y: parseFloat(yPoint)});
                });
                chart = new CanvasJS.Chart("chartContainer",{
                    title:{
                        text:"Live Chart with dataPoints from External JSON"
                    },
                    data: [{
                        markerSize: 1,
                        color:"blue",
                        type: "line",
                        dataPoints: dataPoints
                    }],
                    axisX:{
                        valueFormatString: "HH:mm:ss" ,
                        labelAngle: -50,
                        lineThickness:0.5,
                        tickThickness:0.5,
                    },
                    axisY: {
                        valueFormatString: "#,###",
                        maximum: 1,
                        minimum: -1,
                        lineThickness:1,
                        tickThickness: 1,
                        gridThickness: 1,
                    },
                    toolTip:{
                        enabled: true,
                        animationEnabled: false,
                    },
                    backgroundColor: "transparent",
                    colorSet: "greenShades",
                    animationEnabled: true,
                    theme: "theme3",
                    zoomEnabled: true,
                    panEnabled: true,
                });
                chart.render();
                tick(data)
            }
            /*complete:function(data){
                setTimeout(tick, 1000);
            }*/
        });
    }

    function initializeD3() {
        reloadPlotD3();
    }

    function runExperiment(){
        setTimeout(initializeD3, 1000);
    }
</script>

<!--
<script>

    var obj1 = {};
    obj1["id"] = 1;
    obj1["bestIndividual"] = 0.8;

    var obj2 = {};
    obj2["id"] = 2;
    obj2["bestIndividual"] = 0.3;

    var obj3 = {};
    obj3["id"] = 3;
    obj3["bestIndividual"] = 0.8;

    var n = 243,
        duration = 1000,
        now = new Date(Date.now() - duration),
        count = 0,
        scrollData = [];

    scrollData.push(obj1);
    scrollData.push(obj2);
    scrollData.push(obj3);

    var margin = { top: 6, right: 0, bottom: 20, left: 40 },
        width = 960 - margin.right,
        height = 120 - margin.top - margin.bottom;

    var x = d3
        .scaleTime()
        .domain([now - (n - 2) * duration, now - duration])
        .range([0, width]);

    var y = d3.scaleLinear().range([height, 0]);

    var line = d3
        .line()
        .x(function(d, i) {
            return x(now - (n - 1 - i) * duration);
        })
        .y(function(d, i) {
            return y(d);
        })
        .curve(d3.curveBasis);

    var svg = d3
        .select(".graph")
        .append("p")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .style("margin-left", -margin.left + "px")
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    svg
        .append("defs")
        .append("clipPath")
        .attr("id", "clip")
        .append("rect")
        .attr("width", width)
        .attr("height", height);

    var xAxis = d3.axisBottom(x);

    var axis = svg
        .append("g")
        .attr("class", "xaxis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

    var path = svg
        .append("g")
        .attr("clip-path", "url(#clip)")
        .append("path")
        .datum(scrollData)
        .attr("class", "line");

    var transition = d3
        .transition()
        .duration(duration)
        .ease(d3.easeLinear);

    function tick(data) {

        transition = transition
            .each(function() {
                // update the domains
                now = new Date();
                x.domain([now - (n - 2) * duration, now - duration]);
                y.domain([0, data['bestIndividual']]);

                // push the accumulated count onto the back, and reset the count
                scrollData.push(data['bestIndividual']);
                count = 0;

                // redraw the line
                svg.select(".line").attr("d", line).attr("transform", null);
                // slide the line left
                path
                    .transition(transition)
                    .attr("transform", "translate(" + x(now - (n - 1) * duration) + ")");

                // slide the x-axis left
                d3.select(".xaxis").transition(transition).call(d3.axisBottom(x));

                // pop the old data point off the front
                scrollData.shift();
            })
            .transition()
            .on("start", reloadPlotD3);
    }

    function reloadPlotD3() {
        $.ajax({
            url: encodeURI("/user/rest/diagramFlow"),
            type: "GET",
            dataType: "json",
            success: function(data){
                tick(data)
            },
            complete:function(data){
                setTimeout(tick, 1000);
            }
        });
    }

    function initializeD3() {
        reloadPlotD3();
    }

    function runExperiment(){
        setTimeout(initializeD3, 1000);
    }

</script>
-->

<!--
<script>
    var n = 243,
        data = [{
            "id": 282,
            "bestIndividual": 0.0,
            "longRunId": 267,
            "longUserId": 1,
            "time": "2018-05-27 16:50:27"
        }],
        duration = 1000,
        now = new Date(Date.now() - duration);

    // Parse the date / time
    var format = d3.timeFormat("%H:%M:%S");

    var margin = { top: 6, right: 0, bottom: 20, left: 40 },
        width = 960 - margin.right,
        height = 120 - margin.top - margin.bottom;

    // domains are derived from data while ranges are constant.
    var x = d3.scaleTime()
        .domain([now - (n - 2) * duration, now - duration])
        .range([0, width]);

    var y = d3.scaleLinear()
        .domain([-1, 1])
        .range([height, 0]);

    var line = d3
        .line()
        .x(function(d, i) {
            return x(now - (n - 1 - i) * duration);
        })
        .y(function(d, i) {
            return y(d);
        })
        .curve(d3.curveBasis);

    var svg = d3
        .select("svg")
        .append("p")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .style("margin-left", -margin.left + "px")
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    svg
        .append("defs")
        .append("clipPath")
            .attr("id", "clip")
        .append("rect")
            .attr("width", width)
            .attr("height", height);

    var xAxis = d3.axisBottom(x);

    var axis = svg
        .append("g")
        .attr("class", "xaxis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

    var path = svg
        .append("g")
        .attr("clip-path", "url(#clip)")
        .append("path")
        .datum(data)
        .attr("class", "line");

    var transition = d3
        .transition()
        .duration(duration)
        .ease(d3.easeLinear);

    /*g.append("g")
        .attr("class", "axis axis- esto va junto -x")
        .attr("transform", "translate(0," + y(0) + ")")
        .call(d3.axisBottom(x));

    g.append("g")
        .attr("class", "axis axis- esto va junto -y")
        .call(d3.axisLeft(y));

    g.append("g")
            .attr("clip-path", "url(#clip)")
        .append("path")
            .datum(data)
            .attr("class", "line")
            .transition()
            .duration(500)
            .ease(d3.easeLinear);*/

    function tick(diagramData) {
        transition = transition
            .each(function() {
                // update the domains
                now = new Date();
                x.domain([now - (n - 2) * duration, now - duration]);
                y.domain([0, d3.max(diagramData)]);

                // push the accumulated count onto the back
                data.push(diagramData);

                // redraw the line
                svg.select(".line").attr("d", line).attr("transform", null);
                // slide the line left

                alert("antes de transition");

                path
                    .transition(transition)
                    .attr("transform", "translate(" + x(now - (n - 1) * duration) + ")");


                // slide the x-axis left
                /*d3.select(".xaxis")
                    .transition(transition).call(d3.axisBottom(x));*/

                // pop the old data point off the front
                data.shift();
                alert("despues de shift");
            })
            .on("start", reloadPlotD3);
        alert("despues start");
    }
    //.transition()

    /*function tick(diagramData) {

        // var bestIndividual = data['bestIndividual'];

        // Push a new data point onto the back.
        data.push(diagramData);

        alert("antes de path");

        // Redraw the line.
        d3.select(this)
            .attr("y", line)
            .attr("transform", null);
        /*d3.select(this)
            .attr("d", line)
            .attr("transform", null);*/
        /*path.attr("d", line)
            .attr("transform", null)
            .transition()
            .attr("transform", "translate(" + x(-1) + ")");*/

        /*
        alert("antes de translate")

        // Slide it to the left.
        d3.active(this)
            .attr("transform", "translate(" + x(-1) + ",0)")
            .transition()
            .on("start", reloadPlotD3);

        // Pop the old data point off the front.
        data.shift();
        alert("despues de shift");
    }*/

    /* function renderErrorD3() {
        $("#chart").empty();
        $("#chartError").show();
    }*/

    function reloadPlotD3() {
        $.ajax({
            url: encodeURI("/user/rest/diagramFlow"),
            type: "GET",
            dataType: "json",
            success: function(data){
                tick(data)
            },
            complete:function(data){
                setTimeout(reloadPlotD3, 1000);
            }
        });
    }

    function initializeD3() {
        reloadPlotD3();
    }

    function runExperiment(){
        setTimeout(initializeD3, 1000);
    }

</script>
-->

<!--
<script>

    // Set the dimensions of the canvas / graph
    var margin = {top: 30, right: 20, bottom: 30, left: 50},
        width = 600 - margin.left - margin.right,
        height = 270 - margin.top - margin.bottom;

    // Parse the date / time
    // var format = d3.timeFormat("%Y-%m-%d %H:%M:%S");
    var format = d3.timeFormat("%Y-%m-%d %X");
    //var parseDate = d3.time.format("%d-%b-%y").parse;

    // Set the ranges
    var x = d3.scaleTime().range([0, width]);
    var y = d3.scaleLinear().range([height, 0]);

    // Define the axes
    var xAxis = d3.axisBottom(x).ticks(5);
    var yAxis = d3.axisLeft(y).ticks(5);

    // Define the line
    var valueline = d3.line()
        .x(function(d) { return x(d.date); })
        .y(function(d) { return y(d.close); });

    // Adds the svg canvas
    // var svg = d3.select('svg')
    var svg = d3.select("#d3")
        .attr("class", "bestIndividualChart")
        .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
        .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

    // Get the data
    function renderPlotD3(data) {

        // Redraw the line.
        d3.select(this)
            .attr("d", line)
            .attr("transform", null);
        // Slide it to the left.
        d3.active(this)
            .attr("transform", "translate(" + x(-1) + ",0)")
            .transition()
            .on("start", tick);
        // Pop the old data point off the front.
        data.shift();

        alert("bestIndividual = "+ data['bestIndividual']);
        // alert("time = "+ data['time']);

        var bestIndividual = parseFloat(data['bestIndividual']);

        // Scale the range of the data
        x.domain(d3.extent(data, function(d) { return d.date; }));
        //y.domain(d3.extent(data, function(d) { return d.value }));
        // y.domain([0, d3.max(data, function(d) { return d.close; })]);
        y.domain([-1, 1]);

        var svg = d3.select("#d3").transition();

        // Add the valueline path.
        // .datum(data)
        // .attr("class", "line")
        // .attr("fill", "none")
        // .attr("stroke", "steelblue")
        // .attr("stroke-linejoin", "round")
        // .attr("stroke-linecap", "round")
        // .attr("stroke-width", 1.5)
        // .attr("d", line);
        svg.append("path")
            .attr("class", "line")
            .attr("d", valueline(data))
            .attr("transform", null)
            .transition()
            .attr("transform", "translate(" + x(-1) + ")");


        // redraw the line, and then slide it to the left
        svg.append("path")
            .attr("d", line)


        // pop the old data point off the front
        data.shift();

        // Add the X Axis

        // .select(".domain")
        // .append("text")
        // .remove();
        svg.append("g")
            .attr("class", "x axis")
            .call(xAxis)
            .attr("transform", "translate(0," + height + ")");

        // Add the Y Axis
        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis);

            /*
            .append("text")
            .attr("class", "y axis")
            .attr("fill", "#000")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", "0.71em")
            .attr("text-anchor", "end")
            .call(yAxis)
            .text("Best Individual");*/

        // Make the changes
        svg.select(".line")   // change the line
            .duration(750)
            .attr("d", valueline(data));
        svg.select(".x.axis") // change the x axis
            .duration(750)
            .call(xAxis);
        svg.select(".y.axis") // change the y axis
            .duration(750)
            .call(yAxis);

    }

    function renderErrorD3() {
        $("#chart").empty();
        $("#chartError").show();
    }

    function reloadPlotD3() {
        $.ajax({
            url: encodeURI("/user/rest/diagramFlow"),
            type: "GET",
            dataType: "json",
            success: function(data){
                renderPlotD3(data)
            },
            error: function(data){
                renderErrorD3()
            },
            complete:function(data){
                setTimeout(reloadPlotD3, 1000);
            }
        });
    }

    function initializeD3() {
        reloadPlotD3();
    }

    function runExperiment(){
        setTimeout(initializeD3, 1000);
    }

</script>
-->
<script>
    // Load the file in grammar text area
    // External data file handling starts here
    var control = document.getElementById("grammarFile");
    control.addEventListener("change", function(event){
        var reader = new FileReader();
        reader.onload = function(event){
            var contents = event.target.result;
            document.getElementById('fileText').value = contents;
        };
        reader.onerror = function(event){
            console.error("File could not be read! Code " + event.target.error.code);
        };
        console.log("Filename: " + control.files[0].name);
        reader.readAsText(control.files[0]);
    }, false);
</script>

<script>
    // Download grammar text area file
    function saveTextAsFile() {
        var textToWrite = document.getElementById('fileText').value;
        var textFileAsBlob = new Blob([ textToWrite ], { type: 'text/plain' });
        var fileNameToSaveAs =  document.getElementById('grammarName').value;

        var downloadLink = document.createElement("a");
        downloadLink.download = fileNameToSaveAs+".txt";
        downloadLink.innerHTML = "Download File";

        if (window.webkitURL != null) {
            // Chrome allows the link to be clicked without actually adding it to the DOM.
            downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
        } else {
            // Firefox requires the link to be added to the DOM before it can be clicked.
            downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
            downloadLink.onclick = destroyClickedElement;
            downloadLink.style.display = "none";
            document.body.appendChild(downloadLink);
        }

        downloadLink.click();
    }

    var button = document.getElementById('downloadGrammarButton');
    button.addEventListener('click', saveTextAsFile);

    function destroyClickedElement(event) {
        // remove the link from the DOM
        document.body.removeChild(event.target);
    }
</script>

<script>
    function check(event) {
        if(document.getElementById('radioDataType').checked)
            document.querySelector('#typeFile').required = false;
    }
</script>


<!--
<script>
    function renderPlot(data) {
        $("#chart").empty();
        $("#chartError").hide();

        // var countryName = data.country.name;
        var values = data.values;
        $.jqplot("chart", [values], {
            title: "<h2> Data-flow diagram</h2>",
            axes: {
                xaxis: {
                    label: 'Day of month',
                    pad: 0
                },
                yaxis: {
                    label: 'Best individual'
                }
            }});
    }

    function renderError() {
        $("#chart").empty();
        $("#chartError").show();
    }

    //function reloadPlot(countryCode) {
    //url: encodeURI("/rest/diagramFlow/" + countryCode),
    function reloadPlot(idRun) {
        $.ajax({
            url: encodeURI("/user/rest/diagramFlow/" + idRun),
            type: "GET",
            dataType: "json",
            success: renderPlot,
            error: renderError
        });
    }

    function initializeDiagramData() {
        /*$("#countrySelect").change(function() {
            var countryCode = $(this).val();
            reloadPlot(countryCode);
        });
        reloadPlot($("#countrySelect").val());*/
        alert($("#runId").val());
        reloadPlot($("#runId").val());
    }

    $(document).ready(function() {
        initializeDiagramData();
    });
</script>-->

</body>
</html>